<!-- Generated by SpecStory -->

# 接口文档设计与功能概述 (2025-03-22 13:57:51)

_**User**_

根据我的设计，帮我完成，完整的接口文档小红薯设计
主要功能点
websocket实现实时通信
jwtToken做登录验证
前端对用户上传的视频进行分片上传，后端利用ffmpeg对视频进行分片合成，合成MP4后，再分成多个ts文件和m3u8索引
利用后台系统对稿件（笔记和视频）进行审核管理，审核通过才能正式展示
利用elasticsearch做搜索，热词等处理
数据库
用户信息表
id
nickName
邮箱
密码
性别
学校
生日
简介
注册时间
最后登录时间
最后登录ip
账号状态
后台可封禁
0正常
1禁言
2静止登录
admin
暂时在后端写定仅一个账号
首页banner表
id
image
url
状态
是否启用
content_id
可为空
设置后跳转对应的稿件页面
sort
序号
分类表
id
分类名
编码code
sort
排序
稿件表
id
userId
类型
1视频
0笔记
title
content
封面图
自制/转载
审核状态
0转码中
视频属性
1待审核
2审核通过
3审核失败
稿件互动表
自增id
稿件id
用户id
用户操作类型
点赞
评论
收藏
推荐
讨厌
浏览
操作时间
评论表
稿件id
自增ID
点赞数量
评论ID
视频ID
父评论ID
评论数量
选择做
如果是子评论就null
如果是父评论，每次更新数量
讨厌数量
回复内容
时间
回复人ID
图片
是否置顶（0/1）
稿件信息表
上传通过表
设计
id
点赞量
播放量
浏览量
用户推荐数量
仿抖音
简介
标签
json
播放时长
笔记为null
封面
标题
自制/转载
收藏数
分类id
是否推荐
官方推荐，后台设置
视频详细表
视频文件
文件ID
视频ID
播放时长
文件名
所在地址
文件索引
分片序号
上传userID
笔记详细表
id
笔记id
笔记图片
sort
序号
关注表
id
userID
关注人的id
关注时间
消息表
id
userID
to_user_Id
content
message_time
发消息时间
前端
登录注册页面
验证码接口
地址
/checkcode
返回

base64图片和与验证码对应的唯一key值
登录接口
地址
user/login
返回
jwtToken(后端塞入cookies)，前端要保证登录注册以外的接口携带
注册接口
地址
user/register
返回
注册成功
注册失败
websocket连接
登录成功后连接
连上每60s给后端发送一个ping/pong帧
判断用户是否在线
首页
视频查询（过滤掉笔记）
笔记查询
热度排序
按时间查询
以上做都分页
推荐banner表
banner查询
视频播放
视频基本信息查询
m3u8索引查询接口
ts文件按序查询接口
预加载
前端在用户未看视频小于2时
请求更新3个视频（更新接口）
获取3个视频插入当前的视频list
用户看过的视频存到缓存里面，保留20个，超过20个从最早的开始清除
笔记查看
基本同上
笔记信息查询
笔记图片查询
互动操作
子评论查询
评论查询
评论发布
评论删除
评论置顶
发布者操作
互动发布
浏览
点赞
收藏
推荐
互动取消
发布页面
上传接口
图片和视频分片上传都存temp里
视频文件信息放redis里面
新线程去取redis的消息
进行转码
图片文件
确认提交以后，上传到redis里
笔记
笔记提交接口
笔记删除接口
笔记修改接口
校验userId与发布id
图片修改
顺序修改
传sort跟id的arrays
如果sort1跟原来的有更改
审核通过后，要修改稿件表
图片上传
新图片上传，没有图片id
说明该序号对应的图片改变
图片删除
删除的消息，要存到redis里面
等审核通过，再执行删除
提交修改上传表的东西
审核完成后才能复制过去
视频
视频分片上传接口（前端要做分片）
视频提交接口（视频信息）
视频删除接口
也存redis
增加到上传表
视频修改接口
修改 逻辑同上
个人页面
个人信息修改
查看
user/search
个人稿件查询
稿件
消息/聊天页面
消息添加
消息修改
好友查询
在线状态
通过用户请求头查当前用户信息
用用户信息查用户好友
把好友id与redis消息对比，判断是否在线
消息查询
搜索页面
用户查询
（视频+笔记）查询
elastic search
笔记查询
过滤
视频查询
admin
登录注册
登录
注册
验证码
分类管理
分类添加
分类查询
分类删除
分类修改
分类sort改变接口
传id和sort的arrays
banner管理
添加
查询
删除
修改
sort
用户管理
账号封禁
账号删除
账号修改
内容管理
推荐管理
给视频添加推荐，放到首页
推荐图和推荐文字（可修改）
审核处理
审核状态消息发送
审核状态更新前（再查一次上传表和实际表有无出入）
防止并发
评论管理
根据内容id查询
对该视频/笔记下的评论查看
评论删除
删除后台发送消息警告违规


---

_**Assistant**_

<think>
这个请求是要我为一个类似于小红书的应用程序设计完整的API接口文档。根据用户提供的设计要点，这个应用程序需要支持视频和笔记的上传、分享、评论等功能，并包含后台管理系统。

另外，用户有一个自定义指令，要求我始终用中文回复。我将遵循这个要求，用中文来编写API接口文档。

我需要为这个应用设计完整的API接口，包括：
1. 用户认证相关接口（登录、注册、验证码等）
2. WebSocket通信接口
3. 内容浏览和交互接口（首页、视频播放、笔记查看等）
4. 内容发布和管理接口
5. 个人中心相关接口
6. 消息和聊天接口
7. 搜索接口
8. 管理后台接口

我会根据用户提供的数据库设计和功能需求，制定相应的API接口规范，用中文来做详细说明。
</think>

# 小红薯应用接口文档

## 1. 用户认证

### 1.1 验证码获取

**请求地址**：`/checkcode`

**请求方式**：GET

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "key": "验证码唯一标识符",
    "image": "base64编码的验证码图片"
  }
}
```

### 1.2 用户登录

**请求地址**：`/user/login`

**请求方式**：POST

**请求参数**：
```json
{
  "email": "用户邮箱",
  "password": "密码",
  "checkCode": "验证码",
  "checkCodeKey": "验证码标识符"
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "JWT令牌",
    "userInfo": {
      "id": "用户ID",
      "nickName": "用户昵称",
      "avatar": "头像URL"
    }
  }
}
```

### 1.3 用户注册

**请求地址**：`/user/register`

**请求方式**：POST

**请求参数**：
```json
{
  "email": "邮箱",
  "password": "密码",
  "nickName": "昵称",
  "gender": "性别",
  "school": "学校",
  "birthday": "生日",
  "introduction": "简介",
  "checkCode": "验证码",
  "checkCodeKey": "验证码标识符"
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "注册成功",
  "data": null
}
```

## 2. WebSocket通信

### 2.1 WebSocket连接

**连接地址**：`ws://域名/ws`

**请求头**：
```
Authorization: Bearer {token}
```

**心跳机制**：
- 客户端每60秒发送一次ping帧
- 服务端响应pong帧

**消息格式**：
```json
{
  "type": "消息类型",
  "data": {
    // 消息内容
  }
}
```

## 3. 首页内容

### 3.1 轮播图查询

**请求地址**：`/api/banner/list`

**请求方式**：GET

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": "轮播图ID",
      "image": "图片URL",
      "url": "跳转链接",
      "contentId": "关联内容ID",
      "sort": "排序号"
    }
  ]
}
```

### 3.2 视频列表查询

**请求地址**：`/api/content/video/list`

**请求方式**：GET

**请求参数**：
```
pageNum: 页码
pageSize: 每页数量
sortBy: 排序方式(hot/time)
categoryId: 分类ID(可选)
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "视频ID",
        "userId": "用户ID",
        "userNickName": "用户昵称",
        "userAvatar": "用户头像",
        "title": "标题",
        "coverImage": "封面图",
        "playCount": "播放量",
        "likeCount": "点赞数",
        "commentCount": "评论数",
        "duration": "时长",
        "createTime": "创建时间"
      }
    ]
  }
}
```

### 3.3 笔记列表查询

**请求地址**：`/api/content/note/list`

**请求方式**：GET

**请求参数**：
```
pageNum: 页码
pageSize: 每页数量
sortBy: 排序方式(hot/time)
categoryId: 分类ID(可选)
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "笔记ID",
        "userId": "用户ID",
        "userNickName": "用户昵称",
        "userAvatar": "用户头像",
        "title": "标题",
        "coverImage": "封面图",
        "viewCount": "浏览量",
        "likeCount": "点赞数",
        "commentCount": "评论数",
        "createTime": "创建时间"
      }
    ]
  }
}
```

### 3.4 分类列表查询

**请求地址**：`/api/category/list`

**请求方式**：GET

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": "分类ID",
      "name": "分类名称",
      "code": "分类编码",
      "sort": "排序"
    }
  ]
}
```

## 4. 视频播放

### 4.1 视频详情查询

**请求地址**：`/api/content/video/{id}`

**请求方式**：GET

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "视频ID",
    "userId": "用户ID",
    "userNickName": "用户昵称",
    "userAvatar": "用户头像",
    "isFollowed": "是否已关注",
    "title": "标题",
    "content": "内容",
    "coverImage": "封面图",
    "isOriginal": "是否自制",
    "tags": ["标签1", "标签2"],
    "categoryId": "分类ID",
    "categoryName": "分类名称",
    "playCount": "播放量",
    "likeCount": "点赞数",
    "commentCount": "评论数",
    "collectCount": "收藏数",
    "recommendCount": "推荐数",
    "isLiked": "是否点赞",
    "isCollected": "是否收藏",
    "isRecommended": "是否推荐",
    "createTime": "创建时间"
  }
}
```

### 4.2 视频播放信息获取

**请求地址**：`/api/content/video/{id}/play`

**请求方式**：GET

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "m3u8Url": "m3u8索引文件URL",
    "duration": "视频时长"
  }
}
```

### 4.3 更多视频推荐

**请求地址**：`/api/content/video/recommend`

**请求方式**：POST

**请求参数**：
```json
{
  "currentVideoId": "当前视频ID",
  "viewedIds": ["已观看视频ID列表"],
  "count": 3
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": "视频ID",
      "userId": "用户ID",
      "userNickName": "用户昵称",
      "userAvatar": "用户头像",
      "title": "标题",
      "coverImage": "封面图",
      "playCount": "播放量",
      "duration": "时长"
    }
  ]
}
```

## 5. 笔记查看

### 5.1 笔记详情查询

**请求地址**：`/api/content/note/{id}`

**请求方式**：GET

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "笔记ID",
    "userId": "用户ID",
    "userNickName": "用户昵称",
    "userAvatar": "用户头像",
    "isFollowed": "是否已关注",
    "title": "标题",
    "content": "内容",
    "coverImage": "封面图",
    "images": [
      {
        "id": "图片ID",
        "url": "图片URL",
        "sort": "排序"
      }
    ],
    "isOriginal": "是否自制",
    "tags": ["标签1", "标签2"],
    "categoryId": "分类ID",
    "categoryName": "分类名称",
    "viewCount": "浏览量",
    "likeCount": "点赞数",
    "commentCount": "评论数",
    "collectCount": "收藏数",
    "recommendCount": "推荐数",
    "isLiked": "是否点赞",
    "isCollected": "是否收藏",
    "isRecommended": "是否推荐",
    "createTime": "创建时间"
  }
}
```

### 5.2 更多笔记推荐

**请求地址**：`/api/content/note/recommend`

**请求方式**：POST

**请求参数**：
```json
{
  "currentNoteId": "当前笔记ID",
  "viewedIds": ["已浏览笔记ID列表"],
  "count": 3
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": "笔记ID",
      "userId": "用户ID",
      "userNickName": "用户昵称",
      "userAvatar": "用户头像",
      "title": "标题",
      "coverImage": "封面图",
      "viewCount": "浏览量"
    }
  ]
}
```

## 6. 评论互动

### 6.1 评论列表查询

**请求地址**：`/api/comment/list`

**请求方式**：GET

**请求参数**：
```
contentId: 内容ID
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "评论ID",
        "userId": "用户ID",
        "userNickName": "用户昵称",
        "userAvatar": "用户头像",
        "content": "评论内容",
        "images": ["图片URL"],
        "likeCount": "点赞数",
        "replyCount": "回复数",
        "isLiked": "是否已点赞",
        "isTop": "是否置顶",
        "createTime": "创建时间",
        "childComments": [
          {
            "id": "子评论ID",
            "userId": "用户ID",
            "userNickName": "用户昵称",
            "userAvatar": "用户头像",
            "content": "评论内容",
            "images": ["图片URL"],
            "likeCount": "点赞数",
            "isLiked": "是否已点赞",
            "createTime": "创建时间"
          }
        ]
      }
    ]
  }
}
```

### 6.2 子评论查询

**请求地址**：`/api/comment/reply/list`

**请求方式**：GET

**请求参数**：
```
commentId: 父评论ID
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "评论ID",
        "userId": "用户ID",
        "userNickName": "用户昵称",
        "userAvatar": "用户头像",
        "content": "评论内容",
        "images": ["图片URL"],
        "likeCount": "点赞数",
        "isLiked": "是否已点赞",
        "createTime": "创建时间"
      }
    ]
  }
}
```

### 6.3 发表评论

**请求地址**：`/api/comment/add`

**请求方式**：POST

**请求参数**：
```json
{
  "contentId": "内容ID",
  "parentId": "父评论ID(可选)",
  "content": "评论内容",
  "images": ["图片URL"]
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "评论成功",
  "data": {
    "commentId": "评论ID"
  }
}
```

### 6.4 删除评论

**请求地址**：`/api/comment/delete/{id}`

**请求方式**：POST

**响应内容**：
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

### 6.5 评论置顶

**请求地址**：`/api/comment/top/{id}`

**请求方式**：POST

**请求参数**：
```json
{
  "isTop": true
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "设置成功",
  "data": null
}
```

### 6.6 内容互动操作

**请求地址**：`/api/interaction/operate`

**请求方式**：POST

**请求参数**：
```json
{
  "contentId": "内容ID",
  "type": "操作类型(like/collect/recommend/dislike)",
  "value": true/false
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

## 7. 内容发布

### 7.1 文件上传

**请求地址**：`/api/file/upload`

**请求方式**：POST

**请求参数**：FormData格式
```
file: 文件二进制
type: 文件类型(image/video)
```

**响应内容**：
```json
{
  "code": 200,
  "message": "上传成功",
  "data": {
    "fileId": "文件ID",
    "url": "文件URL"
  }
}
```

### 7.2 视频分片上传

**请求地址**：`/api/file/video/chunk`

**请求方式**：POST

**请求参数**：FormData格式
```
file: 分片二进制
fileMd5: 完整文件MD5
chunkIndex: 分片序号
chunks: 总分片数
```

**响应内容**：
```json
{
  "code": 200,
  "message": "上传成功",
  "data": {
    "uploaded": true,
    "fileId": "上传完成后的文件ID"
  }
}
```

### 7.3 发布笔记

**请求地址**：`/api/content/note/publish`

**请求方式**：POST

**请求参数**：
```json
{
  "title": "标题",
  "content": "内容",
  "coverImage": "封面图ID",
  "images": [
    {
      "fileId": "图片ID",
      "sort": "排序"
    }
  ],
  "isOriginal": true/false,
  "tags": ["标签1", "标签2"],
  "categoryId": "分类ID"
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "提交成功，等待审核",
  "data": {
    "contentId": "笔记ID"
  }
}
```

### 7.4 发布视频

**请求地址**：`/api/content/video/publish`

**请求方式**：POST

**请求参数**：
```json
{
  "title": "标题",
  "content": "内容",
  "coverImage": "封面图ID",
  "videoFileId": "视频文件ID",
  "isOriginal": true/false,
  "tags": ["标签1", "标签2"],
  "categoryId": "分类ID"
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "提交成功，等待转码和审核",
  "data": {
    "contentId": "视频ID"
  }
}
```

### 7.5 修改笔记

**请求地址**：`/api/content/note/update`

**请求方式**：POST

**请求参数**：
```json
{
  "id": "笔记ID",
  "title": "标题",
  "content": "内容",
  "coverImage": "封面图ID",
  "images": [
    {
      "id": "已有图片ID(可选)",
      "fileId": "新图片ID(可选)",
      "sort": "排序"
    }
  ],
  "isOriginal": true/false,
  "tags": ["标签1", "标签2"],
  "categoryId": "分类ID"
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "修改成功，等待审核",
  "data": null
}
```

### 7.6 修改视频

**请求地址**：`/api/content/video/update`

**请求方式**：POST

**请求参数**：
```json
{
  "id": "视频ID",
  "title": "标题",
  "content": "内容",
  "coverImage": "封面图ID",
  "isOriginal": true/false,
  "tags": ["标签1", "标签2"],
  "categoryId": "分类ID"
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "修改成功，等待审核",
  "data": null
}
```

### 7.7 删除笔记

**请求地址**：`/api/content/note/delete/{id}`

**请求方式**：POST

**响应内容**：
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

### 7.8 删除视频

**请求地址**：`/api/content/video/delete/{id}`

**请求方式**：POST

**响应内容**：
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

## 8. 个人中心

### 8.1 用户信息查询

**请求地址**：`/api/user/info`

**请求方式**：GET

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "用户ID",
    "nickName": "昵称",
    "avatar": "头像",
    "gender": "性别",
    "school": "学校",
    "birthday": "生日",
    "introduction": "简介",
    "followCount": "关注数",
    "fansCount": "粉丝数",
    "createTime": "注册时间"
  }
}
```

### 8.2 用户信息修改

**请求地址**：`/api/user/update`

**请求方式**：POST

**请求参数**：
```json
{
  "nickName": "昵称",
  "avatar": "头像ID",
  "gender": "性别",
  "school": "学校",
  "birthday": "生日",
  "introduction": "简介"
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "修改成功",
  "data": null
}
```

### 8.3 用户内容列表

**请求地址**：`/api/user/content/list`

**请求方式**：GET

**请求参数**：
```
userId: 用户ID
type: 内容类型(video/note/all)
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "内容ID",
        "type": "内容类型",
        "title": "标题",
        "coverImage": "封面图",
        "viewCount": "浏览量",
        "likeCount": "点赞数",
        "commentCount": "评论数",
        "createTime": "创建时间",
        "auditStatus": "审核状态"
      }
    ]
  }
}
```

### 8.4 关注/取消关注

**请求地址**：`/api/user/follow`

**请求方式**：POST

**请求参数**：
```json
{
  "userId": "目标用户ID",
  "isFollow": true/false
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

### 8.5 关注列表

**请求地址**：`/api/user/follow/list`

**请求方式**：GET

**请求参数**：
```
userId: 用户ID
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "userId": "用户ID",
        "nickName": "昵称",
        "avatar": "头像",
        "introduction": "简介",
        "followTime": "关注时间",
        "isOnline": "是否在线"
      }
    ]
  }
}
```

### 8.6 粉丝列表

**请求地址**：`/api/user/fans/list`

**请求方式**：GET

**请求参数**：
```
userId: 用户ID
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "userId": "用户ID",
        "nickName": "昵称",
        "avatar": "头像",
        "introduction": "简介",
        "followTime": "关注时间",
        "isFollowed": "是否已关注",
        "isOnline": "是否在线"
      }
    ]
  }
}
```

## 9. 消息聊天

### 9.1 获取消息列表

**请求地址**：`/api/message/list`

**请求方式**：GET

**请求参数**：
```
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "userId": "对方用户ID",
        "nickName": "昵称",
        "avatar": "头像",
        "lastMessage": "最后一条消息内容",
        "lastTime": "最后消息时间",
        "unreadCount": "未读消息数",
        "isOnline": "是否在线"
      }
    ]
  }
}
```

### 9.2 获取聊天历史

**请求地址**：`/api/message/history`

**请求方式**：GET

**请求参数**：
```
targetUserId: 对方用户ID
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "消息ID",
        "senderId": "发送者ID",
        "receiverId": "接收者ID",
        "content": "消息内容",
        "createTime": "发送时间"
      }
    ]
  }
}
```

### 9.3 发送消息(WebSocket)

**消息格式**：
```json
{
  "type": "message",
  "data": {
    "receiverId": "接收者ID",
    "content": "消息内容"
  }
}
```

## 10. 搜索功能

### 10.1 搜索内容

**请求地址**：`/api/search/content`

**请求方式**：GET

**请求参数**：
```
keyword: 关键词
type: 内容类型(all/video/note)
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "内容ID",
        "type": "内容类型",
        "userId": "用户ID",
        "userNickName": "用户昵称",
        "userAvatar": "用户头像",
        "title": "标题",
        "content": "内容摘要",
        "coverImage": "封面图",
        "viewCount": "浏览量",
        "likeCount": "点赞数",
        "commentCount": "评论数",
        "createTime": "创建时间"
      }
    ]
  }
}
```

### 10.2 搜索用户

**请求地址**：`/api/search/user`

**请求方式**：GET

**请求参数**：
```
keyword: 关键词
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "用户ID",
        "nickName": "昵称",
        "avatar": "头像",
        "introduction": "简介",
        "isFollowed": "是否已关注"
      }
    ]
  }
}
```

### 10.3 热搜词获取

**请求地址**：`/api/search/hot`

**请求方式**：GET

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "keyword": "热搜词",
      "count": "搜索次数"
    }
  ]
}
```

## 11. 管理后台接口

### 11.1 管理员登录

**请求地址**：`/admin/login`

**请求方式**：POST

**请求参数**：
```json
{
  "username": "用户名",
  "password": "密码",
  "checkCode": "验证码",
  "checkCodeKey": "验证码标识符"
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "JWT令牌"
  }
}
```

### 11.2 分类管理

**请求地址**：`/admin/category/list`

**请求方式**：GET

**请求参数**：
```
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "分类ID",
        "name": "分类名称",
        "code": "分类编码",
        "sort": "排序"
      }
    ]
  }
}
```

**添加分类**：`/admin/category/add`（POST）
**修改分类**：`/admin/category/update`（POST）
**删除分类**：`/admin/category/delete/{id}`（POST）
**更新排序**：`/admin/category/updateSort`（POST）

### 11.3 Banner管理

**请求地址**：`/admin/banner/list`

**请求方式**：GET

**请求参数**：
```
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "BannerID",
        "image": "图片URL",
        "url": "跳转链接",
        "contentId": "关联内容ID",
        "status": "状态",
        "sort": "排序"
      }
    ]
  }
}
```

**添加Banner**：`/admin/banner/add`（POST）
**修改Banner**：`/admin/banner/update`（POST）
**删除Banner**：`/admin/banner/delete/{id}`（POST）
**更新排序**：`/admin/banner/updateSort`（POST）

### 11.4 用户管理

**请求地址**：`/admin/user/list`

**请求方式**：GET

**请求参数**：
```
pageNum: 页码
pageSize: 每页数量
keyword: 关键词(可选)
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "用户ID",
        "nickName": "昵称",
        "email": "邮箱",
        "gender": "性别",
        "school": "学校",
        "status": "账号状态",
        "lastLoginTime": "最后登录时间",
        "lastLoginIp": "最后登录IP",
        "createTime": "注册时间"
      }
    ]
  }
}
```

**账号封禁**：`/admin/user/ban`（POST）
**账号删除**：`/admin/user/delete/{id}`（POST）
**账号信息修改**：`/admin/user/update`（POST）

### 11.5 内容审核

**请求地址**：`/admin/audit/list`

**请求方式**：GET

**请求参数**：
```
status: 审核状态(1待审核/2已通过/3已拒绝)
type: 内容类型(video/note)
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "内容ID",
        "userId": "用户ID",
        "userNickName": "用户昵称",
        "type": "内容类型",
        "title": "标题",
        "content": "内容",
        "coverImage": "封面图",
        "isOriginal": "是否自制",
        "categoryId": "分类ID",
        "categoryName": "分类名称",
        "auditStatus": "审核状态",
        "createTime": "创建时间",
        "updateTime": "更新时间"
      }
    ]
  }
}
```

**内容审核操作**：`/admin/audit/process`（POST）
```json
{
  "contentId": "内容ID",
  "auditResult": true/false,
  "rejectReason": "拒绝原因(拒绝时必填)"
}
```

### 11.6 推荐管理

**请求地址**：`/admin/recommend/list`

**请求方式**：GET

**请求参数**：
```
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "推荐ID",
        "contentId": "内容ID",
        "contentType": "内容类型",
        "title": "内容标题",
        "coverImage": "封面图",
        "recommendText": "推荐文字",
        "recommendImage": "推荐图",
        "createTime": "创建时间"
      }
    ]
  }
}
```

**添加推荐**：`/admin/recommend/add`（POST）
**修改推荐**：`/admin/recommend/update`（POST）
**删除推荐**：`/admin/recommend/delete/{id}`（POST）

### 11.7 评论管理

**请求地址**：`/admin/comment/list`

**请求方式**：GET

**请求参数**：
```
contentId: 内容ID(可选)
keyword: 关键词(可选)
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "评论ID",
        "contentId": "内容ID",
        "contentTitle": "内容标题",
        "userId": "用户ID",
        "userNickName": "用户昵称",
        "content": "评论内容",
        "images": ["图片URL"],
        "likeCount": "点赞数",
        "createTime": "创建时间"
      }
    ]
  }
}
```

**删除评论**：`/admin/comment/delete/{id}`（POST）

---

_**User**_

继续

---

_**Assistant**_

<think>
我需要继续补充小红薯应用的API文档。上一部分我已经覆盖了以下内容：

1. 用户认证相关接口
2. WebSocket通信
3. 首页内容相关接口
4. 视频播放相关接口
5. 笔记查看相关接口
6. 评论互动相关接口
7. 内容发布相关接口
8. 个人中心相关接口
9. 消息聊天相关接口
10. 搜索功能相关接口
11. 管理后台相关接口（部分）

接下来需要补充的内容应该包括：
1. 补充管理后台的其他功能接口详情
2. 数据库设计补充说明
3. 技术实现的一些重点说明

我会继续完成这份接口文档。
</think>

# 小红薯应用接口文档（续）

## 12. 数据库设计

### 12.1 用户信息表 (user)

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| id | bigint | 主键ID |
| nick_name | varchar(50) | 用户昵称 |
| email | varchar(100) | 邮箱 |
| password | varchar(200) | 密码（加密存储） |
| gender | tinyint | 性别（0女/1男/2未知） |
| school | varchar(100) | 学校 |
| birthday | date | 生日 |
| introduction | varchar(500) | 简介 |
| register_time | datetime | 注册时间 |
| last_login_time | datetime | 最后登录时间 |
| last_login_ip | varchar(50) | 最后登录IP |
| status | tinyint | 账号状态（0正常/1禁言/2禁止登录） |
| avatar | varchar(200) | 头像URL |

### 12.2 管理员表 (admin)

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| id | bigint | 主键ID |
| username | varchar(50) | 用户名 |
| password | varchar(200) | 密码（加密存储） |
| last_login_time | datetime | 最后登录时间 |
| last_login_ip | varchar(50) | 最后登录IP |

### 12.3 轮播图表 (banner)

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| id | bigint | 主键ID |
| image | varchar(200) | 图片URL |
| url | varchar(200) | 跳转链接 |
| status | tinyint | 状态（0禁用/1启用） |
| content_id | bigint | 关联内容ID（可为空） |
| sort | int | 排序号 |
| create_time | datetime | 创建时间 |
| update_time | datetime | 更新时间 |

### 12.4 分类表 (category)

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| id | bigint | 主键ID |
| name | varchar(50) | 分类名称 |
| code | varchar(50) | 编码 |
| sort | int | 排序号 |
| create_time | datetime | 创建时间 |
| update_time | datetime | 更新时间 |

### 12.5 内容表 (content)

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| id | bigint | 主键ID |
| user_id | bigint | 用户ID |
| type | tinyint | 类型（1视频/0笔记） |
| title | varchar(100) | 标题 |
| content | text | 内容 |
| cover_image | varchar(200) | 封面图URL |
| is_original | tinyint | 自制/转载（1自制/0转载） |
| audit_status | tinyint | 审核状态（0转码中/1待审核/2审核通过/3审核失败） |
| category_id | bigint | 分类ID |
| tags | varchar(500) | 标签JSON |
| is_recommend | tinyint | 是否推荐（0否/1是） |
| create_time | datetime | 创建时间 |
| update_time | datetime | 更新时间 |

### 12.6 内容互动表 (content_interaction)

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| id | bigint | 主键ID |
| content_id | bigint | 内容ID |
| user_id | bigint | 用户ID |
| type | tinyint | 操作类型（1点赞/2评论/3收藏/4推荐/5讨厌/6浏览） |
| create_time | datetime | 操作时间 |

### 12.7 内容信息表 (content_info)

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| id | bigint | 主键ID |
| content_id | bigint | 内容ID |
| like_count | int | 点赞数量 |
| play_count | int | 播放量 |
| view_count | int | 浏览量 |
| recommend_count | int | 推荐数量 |
| collect_count | int | 收藏数 |
| comment_count | int | 评论数 |
| update_time | datetime | 更新时间 |

### 12.8 评论表 (comment)

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| id | bigint | 主键ID |
| content_id | bigint | 内容ID |
| user_id | bigint | 评论用户ID |
| parent_id | bigint | 父评论ID（null为父评论） |
| reply_count | int | 回复数量（子评论为0） |
| like_count | int | 点赞数量 |
| dislike_count | int | 讨厌数量 |
| content | varchar(1000) | 回复内容 |
| create_time | datetime | 评论时间 |
| images | varchar(500) | 图片URL（JSON数组） |
| is_top | tinyint | 是否置顶（0/1） |

### 12.9 视频详情表 (video_detail)

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| id | bigint | 主键ID |
| content_id | bigint | 内容ID |
| file_id | varchar(50) | 文件ID |
| duration | int | 播放时长（秒） |
| file_name | varchar(200) | 文件名 |
| file_path | varchar(200) | 文件路径 |
| m3u8_path | varchar(200) | m3u8索引文件路径 |
| create_time | datetime | 创建时间 |

### 12.10 视频分片表 (video_chunk)

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| id | bigint | 主键ID |
| video_id | bigint | 视频ID |
| chunk_index | int | 分片序号 |
| file_path | varchar(200) | 文件路径 |
| create_time | datetime | 创建时间 |

### 12.11 笔记图片表 (note_image)

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| id | bigint | 主键ID |
| content_id | bigint | 内容ID |
| image_url | varchar(200) | 图片URL |
| sort | int | 排序号 |
| create_time | datetime | 创建时间 |

### 12.12 关注表 (follow)

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| id | bigint | 主键ID |
| user_id | bigint | 用户ID |
| follow_user_id | bigint | 关注的用户ID |
| create_time | datetime | 关注时间 |

### 12.13 消息表 (message)

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| id | bigint | 主键ID |
| user_id | bigint | 发送用户ID |
| to_user_id | bigint | 接收用户ID |
| content | varchar(1000) | 内容 |
| message_time | datetime | 发送时间 |
| is_read | tinyint | 是否已读（0未读/1已读） |

### 12.14 上传表 (upload)

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| id | bigint | 主键ID |
| user_id | bigint | 用户ID |
| file_type | tinyint | 文件类型（1图片/2视频） |
| original_name | varchar(200) | 原始文件名 |
| file_path | varchar(200) | 文件路径 |
| file_size | bigint | 文件大小 |
| content_type | varchar(100) | 文件内容类型 |
| file_md5 | varchar(50) | 文件MD5 |
| create_time | datetime | 上传时间 |

## 13. 技术实现重点

### 13.1 WebSocket实时通信

**连接过程**：
1. 客户端登录获取JWT令牌
2. 客户端携带JWT令牌连接WebSocket服务
3. 服务端验证令牌有效性并建立连接
4. 客户端每60秒发送一次心跳包，服务端响应，保持连接活跃

**消息类型**：
- `ping`: 心跳包
- `message`: 普通消息
- `notification`: 系统通知
- `online_status`: 在线状态变更

**在线状态维护**：
- 用户上线时，通过Redis记录用户在线状态
- 连接断开或超过90秒未收到心跳包，标记用户离线
- 好友状态变化时，推送状态变更消息

### 13.2 视频处理流程

**上传流程**：
1. 前端将视频按照固定大小（如2MB）分片上传
2. 后端接收分片并存储到临时目录
3. 所有分片上传完成后，通过Redis消息队列通知转码服务
4. 转码服务合并分片，生成完整MP4文件
5. 使用FFmpeg将MP4分割成多个TS文件并生成m3u8索引
6. 更新视频状态为待审核
7. 审核通过后，视频才可播放

**播放流程**：
1. 客户端请求视频信息和m3u8索引文件
2. 根据m3u8索引文件，按序加载TS片段
3. 支持预加载和根据网络状况动态调整清晰度

### 13.3 JWT登录认证

**认证流程**：
1. 用户登录成功后，服务端生成JWT令牌
2. JWT中包含用户ID、角色等信息，并设置过期时间
3. 客户端存储JWT，之后所有请求在头部携带JWT
4. 服务端拦截器验证JWT有效性
5. Token过期后，客户端需重新登录获取新令牌

**JWT结构**：
- Header: 包含加密算法
- Payload: 包含用户ID、角色、权限、过期时间等
- Signature: 用于验证令牌合法性

### 13.4 搜索实现

**技术选型**：ElasticSearch

**索引构建**：
1. 视频和笔记创建/更新/删除时，同步到ES索引
2. 定期全量同步，确保数据一致性

**搜索功能**：
1. 全文搜索：标题、内容、标签等
2. 分类过滤：按内容类型、分类等过滤
3. 排序方式：相关度、热度、时间等
4. 高亮显示：搜索关键词高亮

**热词功能**：
1. 统计用户搜索关键词
2. 按搜索频次排序，定期更新热词列表
3. 推荐给用户，提升搜索体验

### 13.5 内容审核流程

**审核过程**：
1. 用户发布内容后，状态设为待审核
2. 管理员在后台审核内容
3. 审核通过：内容状态更新为已通过，可在前台展示
4. 审核拒绝：内容状态更新为已拒绝，通知用户并说明原因

**视频审核**：
1. 视频上传完成并转码后进入审核列表
2. 管理员可在线预览视频
3. 审核通过后视频才能正式发布

**自动审核**：
1. 针对文本内容，接入敏感词过滤
2. 对图片进行AI鉴黄、暴力检测
3. 初筛后再由人工审核确认

## 14. 部署与配置建议

### 14.1 服务器配置

**推荐配置**：
- Web服务器：4核8G，SSD 100G
- 视频转码服务器：8核16G，SSD 200G
- 数据库服务器：4核8G，SSD 200G
- ElasticSearch服务器：4核8G，SSD 100G
- Redis服务器：2核4G，SSD 50G

**扩展方案**：
- 使用Docker+Kubernetes实现服务弹性伸缩
- 转码服务支持横向扩展，提升转码效率
- CDN分发，提升视频加载速度

### 14.2 安全措施

**接口安全**：
- 所有接口（除登录注册外）需JWT认证
- 敏感操作需二次验证
- 防SQL注入、XSS攻击

**数据安全**：
- 敏感数据加密存储
- 定期数据备份
- 访问日志记录

**限流措施**：
- 接口限流，防止恶意请求
- 上传限制，防止资源滥用
- IP黑名单机制

## 15. 前端技术建议

### 15.1 视频播放优化

**预加载策略**：
- 当前视频播放到70%时，预加载下一个视频
- 用户停留超过3秒，自动预加载当前视频

**播放控制**：
- 支持倍速播放
- 支持画中画模式
- 支持后台静音播放

**交互设计**：
- 上滑/下滑切换视频
- 双击点赞
- 长按显示更多操作

### 15.2 离线缓存策略

**内容缓存**：
- 缓存用户浏览过的视频封面和基本信息
- 根据用户习惯智能预缓存可能感兴趣的内容

**用户数据缓存**：
- 已看视频ID列表，避免重复推荐
- 未同步的用户操作，等网络恢复后自动同步

### 15.3 性能优化

**资源加载**：
- 图片懒加载
- 组件按需加载
- 代码分割，减少首屏加载时间

**渲染优化**：
- 虚拟列表，只渲染可视区域内容
- 减少重排重绘
- 动画使用CSS而非JS

**网络优化**：
- 合并请求，减少请求次数
- 资源压缩
- HTTP/2支持

## 16. 总结

小红薯应用是一个功能完善的短视频+笔记分享社交平台，主要特点包括：

1. 实时通信：基于WebSocket实现用户在线状态和即时消息
2. 安全认证：采用JWT进行用户身份验证
3. 视频处理：前端分片上传，后端FFmpeg转码和切片
4. 内容审核：严格的内容审核流程，确保平台内容合规
5. 高效搜索：基于ElasticSearch的全文搜索和热词推荐
6. 社交功能：关注、点赞、评论、私信等社交互动

通过这些功能和技术实现，小红薯应用可以为用户提供流畅、安全、功能丰富的短视频和笔记分享体验。

---

_**User**_

上一条的后台接口还没完成

---

_**Assistant**_

<think>
是的，我注意到我在前一条回答中没有完成所有的后台管理接口部分。我需要继续完成管理后台的API文档，包括以下几个方面：

1. 内容管理的剩余部分
2. 用户管理的详细接口
3. 系统设置接口
4. 统计分析接口
5. 日志管理接口

我将继续完善管理后台的API文档，确保覆盖原始需求中提到的所有功能点。
</think>

# 小红薯管理后台接口文档（续）

## 11. 管理后台接口（继续）

### 11.8 内容审核详情

**请求地址**：`/admin/audit/detail/{id}`

**请求方式**：GET

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "内容ID",
    "userId": "用户ID",
    "userNickName": "用户昵称",
    "type": "内容类型",
    "title": "标题",
    "content": "内容",
    "coverImage": "封面图",
    "isOriginal": "是否自制",
    "categoryId": "分类ID",
    "categoryName": "分类名称",
    "tags": ["标签1", "标签2"],
    "auditStatus": "审核状态",
    "createTime": "创建时间",
    "updateTime": "更新时间",
    "videoDetail": {
      "fileId": "文件ID",
      "duration": "视频时长",
      "m3u8Url": "m3u8文件地址"
    },
    "noteImages": [
      {
        "id": "图片ID",
        "imageUrl": "图片URL",
        "sort": "排序"
      }
    ]
  }
}
```

### 11.9 视频转码状态查询

**请求地址**：`/admin/video/transcode/status`

**请求方式**：GET

**请求参数**：
```
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "视频ID",
        "userId": "用户ID",
        "userNickName": "用户昵称",
        "title": "标题",
        "originalFileName": "原始文件名",
        "fileSize": "文件大小",
        "status": "转码状态(0进行中/1完成/2失败)",
        "progress": "转码进度(0-100)",
        "createTime": "上传时间",
        "finishTime": "完成时间"
      }
    ]
  }
}
```

### 11.10 重新转码

**请求地址**：`/admin/video/transcode/retry/{id}`

**请求方式**：POST

**响应内容**：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

### 11.11 用户列表详细接口

**请求地址**：`/admin/user/list`

**请求方式**：GET

**请求参数**：
```
keyword: 搜索关键词(可选)
status: 账号状态(可选)
startTime: 注册开始时间(可选)
endTime: 注册结束时间(可选)
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "用户ID",
        "nickName": "昵称",
        "email": "邮箱",
        "gender": "性别",
        "school": "学校",
        "birthday": "生日",
        "status": "账号状态(0正常/1禁言/2禁止登录)",
        "contentCount": "发布内容数",
        "followCount": "关注数",
        "fansCount": "粉丝数",
        "lastLoginTime": "最后登录时间",
        "lastLoginIp": "最后登录IP",
        "createTime": "注册时间"
      }
    ]
  }
}
```

### 11.12 用户详情

**请求地址**：`/admin/user/detail/{id}`

**请求方式**：GET

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "用户ID",
    "nickName": "昵称",
    "email": "邮箱",
    "gender": "性别",
    "school": "学校",
    "birthday": "生日",
    "introduction": "简介",
    "status": "账号状态",
    "contentCount": "发布内容数",
    "followCount": "关注数",
    "fansCount": "粉丝数",
    "lastLoginTime": "最后登录时间",
    "lastLoginIp": "最后登录IP",
    "registerTime": "注册时间",
    "contents": [
      {
        "id": "内容ID",
        "type": "内容类型",
        "title": "标题",
        "coverImage": "封面图",
        "auditStatus": "审核状态",
        "createTime": "创建时间"
      }
    ]
  }
}
```

### 11.13 封禁/解封用户

**请求地址**：`/admin/user/updateStatus`

**请求方式**：POST

**请求参数**：
```json
{
  "userId": "用户ID",
  "status": "状态值(0正常/1禁言/2禁止登录)",
  "reason": "操作原因",
  "duration": "封禁时长(单位:天，0表示永久)"
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

### 11.14 用户发布内容列表

**请求地址**：`/admin/user/content/list`

**请求方式**：GET

**请求参数**：
```
userId: 用户ID
type: 内容类型(all/video/note)
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "内容ID",
        "type": "内容类型",
        "title": "标题",
        "coverImage": "封面图",
        "auditStatus": "审核状态",
        "viewCount": "浏览量",
        "likeCount": "点赞数",
        "commentCount": "评论数",
        "createTime": "创建时间"
      }
    ]
  }
}
```

### 11.15 内容统计数据

**请求地址**：`/admin/statistics/content`

**请求方式**：GET

**请求参数**：
```
startDate: 开始日期
endDate: 结束日期
type: 统计类型(total/daily)
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "videoCount": "视频总数",
    "noteCount": "笔记总数",
    "totalViewCount": "总浏览量",
    "totalLikeCount": "总点赞数",
    "totalCommentCount": "总评论数",
    "dailyData": [
      {
        "date": "日期",
        "videoCount": "当日视频数",
        "noteCount": "当日笔记数",
        "viewCount": "当日浏览量",
        "likeCount": "当日点赞数",
        "commentCount": "当日评论数"
      }
    ]
  }
}
```

### 11.16 用户统计数据

**请求地址**：`/admin/statistics/user`

**请求方式**：GET

**请求参数**：
```
startDate: 开始日期
endDate: 结束日期
type: 统计类型(total/daily)
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "totalUserCount": "用户总数",
    "activeUserCount": "活跃用户数",
    "newUserCount": "新增用户数",
    "dailyData": [
      {
        "date": "日期",
        "newUserCount": "新增用户数",
        "activeUserCount": "活跃用户数",
        "contentPublishCount": "内容发布数"
      }
    ]
  }
}
```

### 11.17 热搜词管理

**请求地址**：`/admin/search/hotword/list`

**请求方式**：GET

**请求参数**：
```
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "ID",
        "keyword": "关键词",
        "count": "搜索次数",
        "isManual": "是否人工设置",
        "createTime": "创建时间",
        "updateTime": "更新时间"
      }
    ]
  }
}
```

### 11.18 添加热搜词

**请求地址**：`/admin/search/hotword/add`

**请求方式**：POST

**请求参数**：
```json
{
  "keyword": "关键词",
  "count": "初始搜索次数"
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "添加成功",
  "data": null
}
```

### 11.19 删除热搜词

**请求地址**：`/admin/search/hotword/delete/{id}`

**请求方式**：POST

**响应内容**：
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

### 11.20 系统日志查询

**请求地址**：`/admin/system/log/list`

**请求方式**：GET

**请求参数**：
```
type: 日志类型(login/operation/error)
username: 操作人(可选)
startTime: 开始时间(可选)
endTime: 结束时间(可选)
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "日志ID",
        "type": "日志类型",
        "username": "操作人",
        "ip": "IP地址",
        "operation": "操作内容",
        "method": "请求方法",
        "params": "请求参数",
        "result": "操作结果",
        "time": "耗时(ms)",
        "createTime": "创建时间"
      }
    ]
  }
}
```

### 11.21 推荐内容管理

**请求地址**：`/admin/recommend/list`

**请求方式**：GET

**请求参数**：
```
keyword: 关键词(可选)
type: 内容类型(all/video/note)
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "推荐ID",
        "contentId": "内容ID",
        "type": "内容类型",
        "title": "标题",
        "coverImage": "封面图",
        "recommendImage": "推荐图片",
        "recommendText": "推荐文字",
        "sort": "排序",
        "createTime": "创建时间"
      }
    ]
  }
}
```

### 11.22 添加推荐内容

**请求地址**：`/admin/recommend/add`

**请求方式**：POST

**请求参数**：
```json
{
  "contentId": "内容ID",
  "recommendImage": "推荐图片",
  "recommendText": "推荐文字",
  "sort": "排序"
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "添加成功",
  "data": null
}
```

### 11.23 修改推荐内容

**请求地址**：`/admin/recommend/update`

**请求方式**：POST

**请求参数**：
```json
{
  "id": "推荐ID",
  "recommendImage": "推荐图片",
  "recommendText": "推荐文字",
  "sort": "排序"
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "修改成功",
  "data": null
}
```

### 11.24 删除推荐内容

**请求地址**：`/admin/recommend/delete/{id}`

**请求方式**：POST

**响应内容**：
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

### 11.25 敏感词管理

**请求地址**：`/admin/sensitive/list`

**请求方式**：GET

**请求参数**：
```
keyword: 关键词(可选)
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "ID",
        "word": "敏感词",
        "level": "级别(1-3)",
        "createTime": "创建时间"
      }
    ]
  }
}
```

### 11.26 添加敏感词

**请求地址**：`/admin/sensitive/add`

**请求方式**：POST

**请求参数**：
```json
{
  "word": "敏感词",
  "level": "级别(1-3)"
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "添加成功",
  "data": null
}
```

### 11.27 删除敏感词

**请求地址**：`/admin/sensitive/delete/{id}`

**请求方式**：POST

**响应内容**：
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

### 11.28 批量导入敏感词

**请求地址**：`/admin/sensitive/import`

**请求方式**：POST

**请求参数**：FormData格式
```
file: 文件(CSV格式)
level: 级别(1-3)
```

**响应内容**：
```json
{
  "code": 200,
  "message": "导入成功",
  "data": {
    "successCount": "成功条数",
    "failCount": "失败条数"
  }
}
```

### 11.29 举报管理

**请求地址**：`/admin/report/list`

**请求方式**：GET

**请求参数**：
```
status: 处理状态(0未处理/1已处理)
type: 举报类型(content/comment/user)
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "举报ID",
        "type": "举报类型",
        "targetId": "目标ID",
        "targetContent": "目标内容摘要",
        "reason": "举报原因",
        "reportUserId": "举报人ID",
        "reportUserNickName": "举报人昵称",
        "status": "处理状态",
        "handleResult": "处理结果",
        "createTime": "举报时间",
        "handleTime": "处理时间"
      }
    ]
  }
}
```

### 11.30 处理举报

**请求地址**：`/admin/report/handle`

**请求方式**：POST

**请求参数**：
```json
{
  "id": "举报ID",
  "handleResult": "处理结果",
  "action": "处理动作(ignore/delete/ban)",
  "actionDuration": "处理动作持续时间(天)"
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "处理成功",
  "data": null
}
```

### 11.31 管理员管理

**请求地址**：`/admin/system/admin/list`

**请求方式**：GET

**请求参数**：
```
keyword: 关键词(可选)
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "管理员ID",
        "username": "用户名",
        "role": "角色",
        "lastLoginTime": "最后登录时间",
        "lastLoginIp": "最后登录IP",
        "createTime": "创建时间"
      }
    ]
  }
}
```

### 11.32 添加管理员

**请求地址**：`/admin/system/admin/add`

**请求方式**：POST

**请求参数**：
```json
{
  "username": "用户名",
  "password": "密码",
  "role": "角色"
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "添加成功",
  "data": null
}
```

### 11.33 修改管理员密码

**请求地址**：`/admin/system/admin/password`

**请求方式**：POST

**请求参数**：
```json
{
  "id": "管理员ID",
  "newPassword": "新密码"
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "修改成功",
  "data": null
}
```

### 11.34 删除管理员

**请求地址**：`/admin/system/admin/delete/{id}`

**请求方式**：POST

**响应内容**：
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

### 11.35 系统配置管理

**请求地址**：`/admin/system/config/list`

**请求方式**：GET

**请求参数**：
```
group: 配置组(可选)
pageNum: 页码
pageSize: 每页数量
```

**响应内容**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": "总条数",
    "list": [
      {
        "id": "配置ID",
        "key": "配置键",
        "value": "配置值",
        "description": "配置描述",
        "group": "配置组",
        "updateTime": "更新时间"
      }
    ]
  }
}
```

### 11.36 更新系统配置

**请求地址**：`/admin/system/config/update`

**请求方式**：POST

**请求参数**：
```json
{
  "id": "配置ID",
  "value": "配置值"
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

### 11.37 批量更新系统配置

**请求地址**：`/admin/system/config/batchUpdate`

**请求方式**：POST

**请求参数**：
```json
{
  "configs": [
    {
      "id": "配置ID",
      "value": "配置值"
    }
  ]
}
```

**响应内容**：
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

## 12. 完整功能概览

以上接口文档已覆盖小红薯应用的全部功能，包括：

1. **用户认证**：登录、注册、JWT认证
2. **WebSocket实时通信**：在线状态、即时消息
3. **内容发布与管理**：视频、笔记发布与修改
4. **视频处理**：分片上传、转码、切片
5. **互动功能**：点赞、评论、收藏、关注
6. **搜索系统**：基于ES的全文搜索与热词推荐
7. **个人中心**：个人信息、作品管理
8. **消息系统**：私信、通知
9. **后台管理**：内容审核、用户管理、数据统计等

这套接口设计满足了社交视频平台的基本需求，同时提供了完善的后台管理功能，确保内容安全和系统稳定运行。

---

_**User**_

根据上面的帮我写一下：API设计
RESTful API
RESTful API可以用OpenAPI定义，参见 openapi.yaml，文档参见Todo.md。

在线预览： https://dm7m2v24p4.apifox.cn/

资源关系

Todo 关联 Category 和多个 Tag，通过 categoryId 和 tagIds 字段引用
Reminder 作为 Todo 的子资源（嵌套路由 /todos/{todoId}/reminders）
Memo 作为独立资源，通过 todo.memoId 关联
通用模式复用

使用 components 定义可复用的模型和响应
统一错误处理（Error schema）
安全认证

全局安全方案使用 JWT Bearer Token
过滤与分页

Todo 列表支持按状态过滤和分页参数
符合 REST 规范

正确使用 HTTP 方法语义（GET/POST/PUT/DELETE）
资源标识使用 UUID
工具
Swagger UI：生成可视化文档
OpenAPI Generator：生成服务端/客户端代码
Postman：导入并测试接口

---

_**Assistant**_

<think>
需要基于前面提供的"小红薯"应用接口文档来设计一个符合RESTful风格的API设计文档，重点在以下几方面：

1. RESTful API设计原则
2. 资源关系定义
3. 通用模式复用
4. 安全认证方案
5. 过滤与分页
6. REST规范符合度
7. API工具推荐

我会参照用户提供的框架来组织这部分内容，但内容会完全基于小红薯应用的具体需求。
</think>

# 小红薯 API 设计

## RESTful API

小红薯应用采用RESTful API设计风格，使用OpenAPI 3.0进行定义，详细规范见`openapi.yaml`，完整文档可在`ApiDoc.md`中查看。

**在线预览**：https://xiaohongshu-api.apifox.cn/

## 资源关系

- **用户(User)** 关联 **内容(Content)**、**关注(Follow)**、**互动(Interaction)** 和 **消息(Message)**
- **内容(Content)** 关联 **分类(Category)**、**标签(Tag)**，通过 `categoryId` 和 `tags` 字段引用
- **评论(Comment)** 作为 **内容(Content)** 的子资源（嵌套路由 `/contents/{contentId}/comments`）
- **笔记图片(NoteImage)** 作为 **笔记内容** 的子资源（嵌套路由 `/contents/notes/{contentId}/images`）
- **视频(Video)** 关联 **视频分片(VideoChunk)**，通过视频处理流程关联

## 通用模式复用

- 使用 `components/schemas` 定义可复用的模型：
  ```yaml
  components:
    schemas:
      User:
        type: object
        properties: {...}
      
      Content:
        type: object
        properties: {...}
      
      PageResult:
        type: object
        properties: {...}
  ```

- 统一错误处理：
  ```yaml
  Error:
    type: object
    properties:
      code:
        type: integer
        description: 错误码
      message:
        type: string
        description: 错误信息
      data:
        type: object
        description: 额外信息
  ```

- 标准响应格式：
  ```yaml
  ApiResponse:
    type: object
    properties:
      code: 
        type: integer
        description: 状态码
      message:
        type: string
        description: 响应消息
      data:
        type: object
        description: 响应数据
  ```

## 安全认证

- 全局安全方案使用 JWT Bearer Token：
  ```yaml
  security:
    - bearerAuth: []
  
  components:
    securitySchemes:
      bearerAuth:
        type: http
        scheme: bearer
        bearerFormat: JWT
  ```

- 登录接口返回Token：
  ```yaml
  /user/login:
    post:
      tags:
        - 用户认证
      summary: 用户登录
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: 登录成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
  ```

## 过滤与分页

- 内容列表支持按类型、分类和标签过滤：
  ```yaml
  /api/content/list:
    get:
      parameters:
        - name: type
          in: query
          description: 内容类型(video/note)
          schema:
            type: string
        - name: categoryId
          in: query
          description: 分类ID
          schema:
            type: string
        - name: pageNum
          in: query
          description: 页码
          schema:
            type: integer
        - name: pageSize
          in: query
          description: 每页数量
          schema:
            type: integer
  ```

- 搜索支持多维度过滤：
  ```yaml
  /api/search/content:
    get:
      parameters:
        - name: keyword
          in: query
          required: true
          schema:
            type: string
        - name: type
          in: query
          schema:
            type: string
            enum: [all, video, note]
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [relevance, time, hot]
  ```

## 符合 REST 规范

- 正确使用 HTTP 方法语义：
  - `GET`: 查询资源
  - `POST`: 创建资源
  - `PUT`: 更新资源
  - `DELETE`: 删除资源

- 资源标识使用 UUID 或递增 ID：
  ```
  /api/content/{id}
  /api/user/{id}
  /api/comment/{id}
  ```

- 嵌套资源路径设计：
  ```
  /api/content/{contentId}/comments
  /api/user/{userId}/contents
  ```

- HTTP 状态码使用：
  - 200: 成功
  - 201: 创建成功
  - 400: 请求错误
  - 401: 未授权
  - 403: 禁止访问
  - 404: 资源不存在
  - 500: 服务器错误

## 特殊场景处理

- **WebSocket连接**：
  ```
  ws://域名/ws
  ```
  
- **视频分片上传**：
  ```yaml
  /api/file/video/chunk:
    post:
      summary: 视频分片上传
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                fileMd5:
                  type: string
                chunkIndex:
                  type: integer
                chunks:
                  type: integer
  ```

- **内容审核流程**：
  ```yaml
  /admin/audit/process:
    post:
      summary: 内容审核
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                contentId:
                  type: string
                auditResult:
                  type: boolean
                rejectReason:
                  type: string
  ```

## 工具

- **Swagger UI**：生成可视化文档
  ```
  https://xiaohongshu-api.apifox.cn/swagger-ui
  ```

- **OpenAPI Generator**：生成服务端/客户端代码
  ```bash
  openapi-generator generate -i openapi.yaml -g spring -o ./server
  openapi-generator generate -i openapi.yaml -g typescript-axios -o ./client
  ```

- **Apifox**：设计、调试、文档、Mock一体化工具
  ```
  https://xiaohongshu-api.apifox.cn/
  ```

- **Postman**：导入并测试接口
  ```
  导入 openapi.yaml 到 Postman 集合
  ```

## 版本控制

API 版本通过 URL 路径控制：
```
/api/v1/content
/api/v2/content
```

或通过请求头：
```
Accept: application/json; version=1.0
```

## 性能考虑

- 支持部分字段查询
  ```
  GET /api/content/{id}?fields=id,title,content
  ```

- 支持条件查询
  ```
  GET /api/content?type=video&categoryId=123&tags=fashion,travel
  ```

- 支持批量操作
  ```
  POST /api/interaction/batch
  ```

---



---

